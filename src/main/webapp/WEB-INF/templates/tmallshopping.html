<html  xmlns:th="http://www.thymeleaf.org">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <link rel="shortcut icon" th:href="@{/resources/img/favicon.ico}" href="/favicon.ico">
	<script src="https://cdn.bootcss.com/jquery/2.2.0/jquery.min.js"></script>
	<link href="https://libs.baidu.com/bootstrap/3.3.0/css/bootstrap.min.css" rel="stylesheet">
	<script src="http://libs.baidu.com/bootstrap/3.0.3/js/bootstrap.min.js"></script>
	<link rel="stylesheet" th:href="@{/resources/css/index.css}" href="../../resources/css/index.css">
	<script th:src="@{/resources/js/index.js}" src="../../resources/js/index.js"></script>
	<script>
		var config = {
			cartSelected_png: function () {
				//https://how2j.cn/tmall/img/site/cartSelected.png
				return "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAANCAYAAAB2HjRBAAABWklEQVQ4EY2RTyiDcRjHP9Ost0YclouZnJQ/JyWy45IdcFlRK9wopRay5bJGhhInbk6bnBzkoiTFVpQSObwHlr9zeFPKYWn89O717t2a1ftcft/neb5/nvpZZFkWiqJgphqeHnCcrFM5s4bV2QiJREKYqu+sEJMdQngQolcSIhYSFWYSc5z4AsiXGv0nA/ZqzInvrmAnYuSMhcDrLxC/3UPm0yDo6CsDSyOQFblJunsIfBM5rCU/yxBww/xgqUEsDI83mpXHT6pvSrf9S94MgJKG62MIeg0D+QJ2VzRyzwBMb+eFKtCSw3vg8WuL2zPN4P0VosOgXtvWCcE4WG3/iG0SzMVgfBUsgGow2gIvKXC1w+IhSFVFQiNZH/tmIbIPUg1kPqC+CaIHYK/VGUVv6Vd19cPWObS6YfkI6lxFgsLGWtjksbMZNk7zbTlgdTgcJJPJcvuSucrX6xcDoYihVMO4YAAAAABJRU5ErkJggg==";
			},
			cartNotSelected_png: function () {
				//https://how2j.cn/tmall/img/site/cartNotSelected.png
				return "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAANCAYAAAB2HjRBAAAAQklEQVQ4EWO8efPm/zdv3jAQC0RERBjU1dUZweqPHj36nxQAUg+ziAnGIIce1UxiqI3EAGMBpdVjx44RHVQg9TAAAC9HPFRFxow6AAAAAElFTkSuQmCC";
			}
		}
	</script>
</head>

<body>

<nav class="top " th:replace="_fragment::nav">

</nav>

<div th:replace="_fragment::search"></div>


<title>购物车</title>
<div class="cartDiv">
	<div class="cartTitle pull-right">
		<span>已选商品  (不含运费)</span>
		<span class="cartTitlePrice">￥0.00</span>
		<button class="createOrderButton" disabled="disabled">结 算</button>
	</div>
	<!--/*@thymesVar id="goods" type="org.seckill.entity.Goods"*/-->
	<div class="cartProductList">
		<table class="cartProductTable">
			<thead>
				<tr>
					<th class="selectAndImage">
							<img selectit="false" class="selectAllItem" src="http://how2j.cn/tmall/img/site/cartNotSelected.png">
					全选
					
					</th>
					<th>商品信息</th>
					<th>单价</th>
					<th>数量</th>
					<th width="120px">金额</th>
					<th class="operation">操作</th>
				</tr>
			</thead>
			<tbody>
					<tr oiid="977" th:attr="oiid=${goods.goodsid}" class="cartProductItemTR">
						<td>
							<img selectit="false" oiid="977" th:attr="oiid=${goods.goodsid}" class="cartProductItemIfSelected" src="http://how2j.cn/tmall/img/site/cartNotSelected.png">
							<a style="display:none" href="javascript:void(0);"><img src="http://how2j.cn/tmall/img/site/cartSelected.png"></a>
							<img class="cartProductImg" th:src="${goods.images1}" src="http://how2j.cn/tmall/img/productSingle_middle/3752.jpg">
						</td>
						<td>
							<div class="cartProductLinkOutDiv">
								<a href="javascript:void(0)" class="cartProductLink" th:text="${goods.goodsseckillprice+'元秒杀'+goods.goodsname}">洁霸BF522多功能洗地机刷地机酒店家用地毯清洗机 擦地机抛光机</a>
								<div class="cartProductLinkInnerDiv">
									<img src="http://how2j.cn/tmall/img/site/creditcard.png" title="支持信用卡支付">
									<img src="http://how2j.cn/tmall/img/site/7day.png" title="消费者保障服务,承诺7天退货">
									<img src="http://how2j.cn/tmall/img/site/promise.png" title="消费者保障服务,承诺如实描述">
								</div>
							</div>
							
						</td>
						<td>
							<span class="cartProductItemOringalPrice" th:text="${goods.goodsorig}">￥1900.0</span>
							<span class="cartProductItemPromotionPrice" th:text="${goods.goodsseckillprice}">￥1235.0</span>
						</td>
						<td>
						
							<div class="cartProductChangeNumberDiv">
								<span class="hidden orderItemStock " pid="321">64</span>
								<span class="hidden orderItemPromotePrice " pid="321">755.65</span>
								<a  pid="321" class="numberMinus" href="javascript:void(0);">-</a>
								<input pid="321" oiid="977" class="orderItemNumberSetting" autocomplete="off" value="1" onfocus=this.blur()>
								<a  stock="64" pid="321" class="numberPlus" href="javascript:void(0);">+</a>
							</div>					
						
						 </td>
						<td >
							<span class="cartProductItemSmallSumPrice" oiid="977" th:attr="oiid=${goods.goodsid}" pid="321" th:text="${'￥'+goods.goodsseckillprice}">
							￥4,940.00
							</span>
						
						</td>
						<td>
							<a class="deleteOrderItem" oiid="977" th:attr="oiid=${goods.goodsid}"  href="javascript:void(0);">删除</a>
						</td>
					</tr>
								
			</tbody>
		
		</table>
	</div>
	
	<div class="cartFoot">
		<img selectit="false" class="selectAllItem" src="http://how2j.cn/tmall/img/site/cartNotSelected.png">
		<span>全选</span>
		<div class="pull-right">
			<span>已选商品 <span class="cartSumNumber" >0</span> 件</span>
			
			<span>合计 (不含运费): </span> 
			<span class="cartSumPrice" >￥0.00</span>
			<button class="createOrderButton" disabled="disabled" >结  算</button>
		</div>
		
	</div>
	
</div>

<div class="modal " id="loginModal" tabindex="-1" role="dialog" >
	<div class="modal-dialog loginDivInProductPageModalDiv">
	        <div class="modal-content">
					<div class="loginDivInProductPage">
						<div class="loginErrorMessageDiv">
							<div class="alert alert-danger" >
							  <button type="button" class="close" data-dismiss="alert" aria-label="Close"></button>
							  	<span class="errorMessage"></span>
							</div>
						</div>
							
						<div class="login_acount_text">账户登录</div>
						<div class="loginInput " >
							<span class="loginInputIcon ">
								<span class=" glyphicon glyphicon-user"></span>
							</span>
							<input id="name" name="name" placeholder="手机/会员名/邮箱" type="text">			
						</div>
						
						<div class="loginInput " >
							<span class="loginInputIcon ">
								<span class=" glyphicon glyphicon-lock"></span>
							</span>
							<input id="password" name="password"  type="password" placeholder="密码">
						</div>
						<div>
							<a href="javascript:void(0);">忘记登录密码</a>
							<a href="javascript:void(0);" class="pull-right">免费注册</a>
						</div>
						<div style="margin-top:20px">
							<button class="btn btn-block redButton loginSubmitButton" type="button">登录</button>
						</div>
					</div>	
	      </div>
	</div>
</div>

<div class="modal" id="deleteConfirmModal" tabindex="-1" role="dialog" >
	<div class="modal-dialog deleteConfirmModalDiv">
       <div class="modal-content">
          <div class="modal-header">
            <button data-dismiss="modal" class="close" type="button"><span aria-hidden="true">×</span><span class="sr-only">Close</span></button>
            <h4 class="modal-title">确认删除？</h4>
          </div>
          <div class="modal-footer">
            <button data-dismiss="modal" class="btn btn-default" type="button">关闭</button>
            <button class="btn btn-primary deleteConfirmButton" id="submit" type="button">确认</button>
          </div>
        </div>
      </div>
	</div>
</div>
<script>
	var deleteOrderItem = false;
	var deleteOrderItemid = 0;
	$(function(){

		$("a.deleteOrderItem").click(function(){
			deleteOrderItem = false;
			var oiid = $(this).attr("oiid");
			deleteOrderItemid = oiid;
			$("#deleteConfirmModal").modal('show');
		});
		$("button.deleteConfirmButton").click(function(){
			deleteOrderItem = true;
			$("#deleteConfirmModal").modal('hide');
		});

		$('#deleteConfirmModal').on('hidden.bs.modal', function (e) {console.log(deleteOrderItem);
			if(deleteOrderItem){
				var page="foredeleteOrderItem";
				$("tr.cartProductItemTR[oiid="+deleteOrderItemid+"]").hide();
				if(false)$.post(
						page,
						{"oiid":deleteOrderItemid},
						function(result){
							if("success"==result){
								$("tr.cartProductItemTR[oiid="+deleteOrderItemid+"]").hide();
							}
							else{
								location.href="login.jsp";
							}
						}
				);

			}
		});

		$("img.cartProductItemIfSelected").click(function(){
			var selectit = $(this).attr("selectit");
			if("selectit"==selectit){
				$(this).attr("src",config.cartNotSelected_png());
				$(this).attr("selectit","false");
				$(this).parents("tr.cartProductItemTR").css("background-color","#fff");
			}
			else{
				$(this).attr("src",config.cartSelected_png());
				$(this).attr("selectit","selectit");
				$(this).parents("tr.cartProductItemTR").css("background-color","#FFF8E1");
			}
			syncSelect();
			syncCreateOrderButton();
			calcCartSumPriceAndNumber();
		});
		$("img.selectAllItem").click(function(){
			var selectit = $(this).attr("selectit");
			if("selectit"==selectit){
				$("img.selectAllItem").attr("src",config.cartNotSelected_png());
				$("img.selectAllItem").attr("selectit","false");
				$(".cartProductItemIfSelected").each(function(){
					$(this).attr("src",config.cartNotSelected_png());
					$(this).attr("selectit","false");
					$(this).parents("tr.cartProductItemTR").css("background-color","#fff");
				});
			}
			else{
				$("img.selectAllItem").attr("src",config.cartSelected_png());
				$("img.selectAllItem").attr("selectit","selectit");
				$(".cartProductItemIfSelected").each(function(){
					$(this).attr("src",config.cartSelected_png());
					$(this).attr("selectit","selectit");
					$(this).parents("tr.cartProductItemTR").css("background-color","#FFF8E1");
				});
			}
			syncCreateOrderButton();
			calcCartSumPriceAndNumber();

		});

		$(".orderItemNumberSetting").keyup(function(){
			var pid=$(this).attr("pid");
			var stock= $("span.orderItemStock[pid="+pid+"]").text();
			var price= $("span.orderItemPromotePrice[pid="+pid+"]").text();

			var num= $(".orderItemNumberSetting[pid="+pid+"]").val();
			num = parseInt(num);
			if(isNaN(num))
				num= 1;
			if(num<=0)
				num = 1;
			if(num>stock)
				num = stock;

			syncPrice(pid,num,price);
		});

		$("button.createOrderButton").click(function(){
			var params = "";
			$(".cartProductItemIfSelected").each(function(){
				if("selectit"==$(this).attr("selectit")){
					var oiid = $(this).attr("oiid");
					params += "&oiid="+oiid;
				}
			});
			params = params.substring(1);
			location.href="forebuy?"+params;
		});

	});

	function syncCreateOrderButton(){
		var selectAny = false;
		$(".cartProductItemIfSelected").each(function(){
			if("selectit"==$(this).attr("selectit")){
				selectAny = true;
			}
		});

		if(selectAny){
			$("button.createOrderButton").css("background-color","#C40000");
			$("button.createOrderButton").removeAttr("disabled");
		}
		else{
			$("button.createOrderButton").css("background-color","#AAAAAA");
			$("button.createOrderButton").attr("disabled","disabled");
		}

	}
	function syncSelect(){
		var selectAll = true;
		$(".cartProductItemIfSelected").each(function(){
			if("false"==$(this).attr("selectit")){
				selectAll = false;
			}
		});

		if(selectAll)
			$("img.selectAllItem").attr("src",config.cartSelected_png());
		else
			$("img.selectAllItem").attr("src",config.cartNotSelected_png());

	}
	function calcCartSumPriceAndNumber(){
		var sum = 0;
		var totalNumber = 0;
		$("img.cartProductItemIfSelected[selectit='selectit']").each(function(){
			var oiid = $(this).attr("oiid");
			var price =$(".cartProductItemSmallSumPrice[oiid="+oiid+"]").text();
			price = price.replace(/,/g, "");
			price = price.replace(/￥/g, "");
			sum += Number(price);

			var num =$(".orderItemNumberSetting[oiid="+oiid+"]").val();
			totalNumber += Number(num);

		});
		console.log(sum);
		console.log(formatMoney(sum));

		$("span.cartSumPrice").html("￥"+formatMoney(sum));
		$("span.cartTitlePrice").html("￥"+formatMoney(sum));
		$("span.cartSumNumber").html(totalNumber);
	}
	function syncPrice(pid,num,price){
		$(".orderItemNumberSetting[pid="+pid+"]").val(num);
		var cartProductItemSmallSumPrice = formatMoney(num*price);
		$(".cartProductItemSmallSumPrice[pid="+pid+"]").html("￥"+cartProductItemSmallSumPrice);
		calcCartSumPriceAndNumber();

		var page = "forechangeOrderItem";
		if(false)$.post(
				page,
				{"pid":pid,"number":num},
				function(result){
					if("success"!=result){
						location.href="login.jsp";
					}
				}
		);

	}
</script>
<div id="footer" th:replace="_fragment::footer" class="footer" style="display: block;">
</div>
</body>
</html>